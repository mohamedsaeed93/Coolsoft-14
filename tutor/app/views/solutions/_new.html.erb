<p class="compilation_failed" ><%= flash[:alert] %></p>
<!-- Timer that starts when problem is shown -->
<b>Time spent:</b>
<span id="mins">0</span>:<span id="secs">00</span>


<%= form_for :solution,
	:url => { :controller => "solutions", :action => "create" },
	:html => {:method => :post} do |f| %>
<%=
	@code = f.hidden_field "code", :id =>'solution_code',
	value: flash[:previous_code] == nil ?
		"\tpublic static void main(String [] args) {\n\t\t\n\t}\n}"
		 : flash[:previous_code].to_s
%>
<%= f.hidden_field :problem_id, value: params[:id] %>
<br>
	<!--Author: Ahmed Moataz-->
	<div class="">
		<!-- Add editor -->
		<pre id="editor">
		</pre>
	</div>
	<%= f.hidden_field :problem_id, value: params[:id] %>
	<br>
	<table width='100%'>
		<tr>
			<td>
				<%= button_tag 'Compile', type: 'Button',
					id: 'compileButton', onClick: 'compile()' %>
				<%= button_tag 'Start Debugging', id: 'debugButton', type: 'button',
					onclick: "start_debug(#{params[:id]})" %>
				<%= button_tag 'Previous', type: 'Button',
					id: 'previousButton', onClick: 'previous()', hidden: true %>
				<%= button_tag 'Next', type: 'Button',
					id: 'nextButton', onClick: 'next()', hidden: true %>
				<%= button_tag 'Stop Debugging', type: 'Button',
					id: 'stopButton', onClick: 'stop()', hidden: true %>
				<span id="spinner" class="" align="center"></span>
			</td>
			<td style='text-align:right;'>
				<b class='accepted'>Accepted</b>
				<b class='wrong_answer'>Wrong Answer</b>
				<b class='runtime_error'>Runtime Error</b>
				<b class='compilation_error'>Compilation Error</b>
				<%= f.submit "Compile" %>
				<%= f.submit "Run Test Case" %>
				<%= f.submit "Submit" %>
			</td>
		</tr>
	</table>
	<br /><br />
	<div>
		<b>Input:</b></br>
		<%= f.text_area :input, placeholder: "Write your test case here", 
			value: @input, class: "form-control", style: "width:400px" %>
	</div>
	</br>
	<div>
		<b>Output:</b>
		<% if flash[:exp] || flash[:exp_2] %>
			<div class="panel panel-danger fixed-content", style="white-space: pre">
				<div class="panel-heading", style="min-height: 30px;
				max-height: 30px; line-height:0.25px; margin-top: -45px">
					<h3 class="panel-title"> Error </h3>
				</div>
				<div class="panel-body", style= "margin-top:-100px">
					<p><%= flash[:msg] %></p>
					<% if flash[:msg_2] %>
						<% flash[:msg_2].each do |message| %>
						<p><%= message %></p>
						<% end %>
					<% end %>
				</div>
				<div class="panel-heading", style="min-height: 30px;
				max-height: 30px; line-height:0.25px; margin-top: -90px">
					<h3 class="panel-title"> Explanation </h3>
				</div>
				<div class="panel-body", style= "margin-top:-100px">
					<p><%= flash[:exp] %></p>
					<% if flash[:exp_2] %>
						<% flash[:exp_2].each do |message| %>
						<p><%= message %></p>
						<% end %>
					<% end %>
				</div>
			</div>
		<% else %>
			<div>
				<p><%= flash[:msg] %></p>
			</div>
		<% end %>
	</div>
	<!--Author: Ahmed Moataz-->
	<b>Console:</b><br/>
	<div class="console">
		<p class="compilation_succeeded" > <%= flash[:compiler_success] %> </p>
		<p class="compilation_failed" ><%= flash[:compiler_fail] %></p>
		<% if flash[:compiler_success_2] %>
			<% flash[:compiler_success_2].each do |message| %>
			<p class="compilation_succeeded"> <%= message %> </p>
			<% end %>
		<% end %>
		<% if flash[:compiler_fail_2] %>
			<% flash[:compiler_fail_2].each do |message| %>
			<p class="compilation_failed" > <%= message %> </p>
			<% end %>
		<% end %>
		<p class="compilation_feedback" ><%= flash[:compiler_feedback] %></p>
	</div>
<script>
	var editor = ace.edit("editor");
	var edit_session = editor.getSession();
	var hidden_code_field = document.getElementById('solution_code')
	var code_header = "public class CoolSoft {\n";
	var code_footer = "\n}";

	editor.setTheme("ace/theme/twilight");
	edit_session.setMode("ace/mode/java");

	edit_session.setValue(code_header + hidden_code_field.value);

	var code_filter_function = function(event_handler) {
		var unfiltered_code = edit_session.getValue();
		var code_len = unfiltered_code.length;
		var line_count = edit_session.doc.getAllLines().length;
		
		if(unfiltered_code.indexOf(code_header) != 0) {
			edit_session.doc.insertLines(0, [code_header]);
			return;
		} else {
			hidden_code_field.value = unfiltered_code.slice(code_header.length)
		}
	};
	

	edit_session.on('change', code_filter_function);
</script> 
<% end %>